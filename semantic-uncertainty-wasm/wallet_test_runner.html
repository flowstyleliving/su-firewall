<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>üß™ Wallet Integration Test Runner - 0x9B613eD794B81043C23fA4a19d8f674090313b81</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff41;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: #00ff41;
            text-shadow: 0 0 20px #00ff41;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .wallet-info {
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            border: 2px solid #ff6b35;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .wallet-address {
            font-family: 'Monaco', monospace;
            color: #ff6b35;
            font-size: 1.1em;
            font-weight: bold;
            word-break: break-all;
            margin: 10px 0;
        }
        
        .status-panel {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .status-panel.success {
            border-left: 4px solid #00ff41;
        }
        
        .status-panel.warning {
            border-left: 4px solid #ffaa00;
        }
        
        .status-panel.error {
            border-left: 4px solid #ff4444;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-section {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
        }
        
        .test-section h3 {
            color: #0099cc;
            border-bottom: 2px solid #0099cc;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .metric {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .metric-label {
            color: #0099cc;
        }
        
        .metric-value {
            color: #00ff41;
            font-weight: bold;
        }
        
        .metric-value.warning {
            color: #ffaa00;
        }
        
        .metric-value.error {
            color: #ff4444;
        }
        
        .test-result-item {
            background: #1a1a1a;
            border-left: 3px solid #00ff41;
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 6px 6px 0;
        }
        
        .test-result-item.warning {
            border-left-color: #ffaa00;
        }
        
        .test-result-item.error {
            border-left-color: #ff4444;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: #0a0a0a;
            border: none;
            padding: 15px 30px;
            font-family: inherit;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }
        
        button:hover {
            background: linear-gradient(45deg, #f7931e, #ff6b35);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }
        
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .console-output {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 0.85em;
            white-space: pre-wrap;
            font-family: 'Monaco', monospace;
        }
        
        .loading-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #333;
            border-top: 3px solid #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-bar {
            background: #333;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #ff6b35, #f7931e);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .faucet-link {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid #ff6b35;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .faucet-link a {
            color: #ff6b35;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .summary-box {
            background: linear-gradient(45deg, rgba(26, 26, 26, 0.9), rgba(22, 33, 62, 0.9));
            border: 2px solid #00ff41;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
        }
        
        .summary-box.warning {
            border-color: #ffaa00;
        }
        
        .summary-box.error {
            border-color: #ff4444;
        }
        
        .verification-preview {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 10px;
            margin: 8px 0;
            font-size: 0.9em;
        }
        
        .verification-preview .text-preview {
            color: #ccc;
            font-style: italic;
        }
        
        .verification-preview .metrics {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Wallet Integration Test Runner</h1>
        
        <div class="wallet-info">
            <h3>üî• TESTING WITH REAL A0GI TESTNET TOKENS</h3>
            <div class="wallet-address">0x9B613eD794B81043C23fA4a19d8f674090313b81</div>
            <p>Comprehensive integration test with your MetaMask wallet and testnet tokens</p>
        </div>
        
        <div class="status-panel" id="test-status">
            <div id="status-content">
                <strong>Status:</strong> Ready to run comprehensive wallet integration tests
            </div>
            <div class="progress-bar" id="progress-bar" style="display: none;">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üöÄ Test Controls</h3>
            <button onclick="runComprehensiveTests()" id="run-comprehensive-btn">
                üß™ Run All Wallet Tests
            </button>
            <button onclick="runQuickTest()" id="run-quick-btn">
                ‚ö° Quick Balance Check
            </button>
            <button onclick="openProductionDemo()" id="production-demo-btn">
                üéØ Open Production Demo
            </button>
            <button onclick="clearResults()" id="clear-btn">
                üóëÔ∏è Clear Results
            </button>
        </div>
        
        <div class="test-grid">
            <!-- Wallet Status -->
            <div class="test-section">
                <h3>üí≥ Wallet Status</h3>
                <div id="wallet-status">
                    <div class="loading-indicator" style="display: none;" id="wallet-loading"></div>
                    <div id="wallet-info">Click "Run Wallet Tests" to check your wallet status</div>
                </div>
            </div>
            
            <!-- Network Info -->
            <div class="test-section">
                <h3>üåê Network Information</h3>
                <div id="network-info">
                    <div>Network validation not run yet...</div>
                </div>
            </div>
            
            <!-- Balance & Gas -->
            <div class="test-section">
                <h3>üí∞ Balance & Gas Analysis</h3>
                <div id="balance-info">
                    <div>Balance check not run yet...</div>
                </div>
                
                <div class="faucet-link">
                    <a href="https://faucet.0g.ai" target="_blank">üíß Get A0GI Testnet Tokens</a>
                    <br><small>Daily Limit: 0.1 A0GI per wallet</small>
                </div>
            </div>
            
            <!-- Semantic Tests -->
            <div class="test-section">
                <h3>üß† Semantic Verification Tests</h3>
                <div id="semantic-tests">
                    <div>Semantic verification tests not run yet...</div>
                </div>
            </div>
        </div>
        
        <!-- Test Results Summary -->
        <div class="summary-box" id="test-summary" style="display: none;">
            <h3 id="summary-title">Test Results Summary</h3>
            <div id="summary-content"></div>
        </div>
        
        <!-- Console Output -->
        <div class="test-section">
            <h3>üìü Test Console Output</h3>
            <div class="console-output" id="console-output">
                Wallet Integration Test Console - Ready to run tests with your A0GI testnet tokens...
            </div>
        </div>
    </div>

    <script type="module">
        import WalletIntegrationTester from './wallet_integration_test.js';
        import ZeroGConnectionTester from './test_0g_connection.js';
        
        let walletTester = null;
        let testOutput = '';
        let testProgress = 0;
        
        // Override console.log to capture output
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            testOutput += new Date().toLocaleTimeString() + ' ' + args.join(' ') + '\n';
            updateConsoleOutput();
        };
        
        function updateConsoleOutput() {
            const consoleEl = document.getElementById('console-output');
            if (consoleEl) {
                consoleEl.textContent = testOutput;
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }
        }
        
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-content');
            const statusPanel = document.getElementById('test-status');
            
            statusEl.innerHTML = `<strong>Status:</strong> ${message}`;
            
            // Update panel style
            statusPanel.className = 'status-panel';
            if (type === 'success') {
                statusPanel.classList.add('success');
            } else if (type === 'warning') {
                statusPanel.classList.add('warning');
            } else if (type === 'error') {
                statusPanel.classList.add('error');
            }
        }
        
        function updateProgress(percent) {
            const progressBar = document.getElementById('progress-bar');
            const progressFill = document.getElementById('progress-fill');
            
            if (percent > 0) {
                progressBar.style.display = 'block';
                progressFill.style.width = percent + '%';
            } else {
                progressBar.style.display = 'none';
            }
        }
        
        window.runComprehensiveTests = async function() {
            const runBtn = document.getElementById('run-comprehensive-btn');
            runBtn.disabled = true;
            runBtn.innerHTML = '<div class="loading-indicator"></div>Running Comprehensive Tests...';
            
            testOutput = '';
            updateStatus('üß™ Starting comprehensive wallet integration tests...', 'info');
            updateProgress(0);
            
            try {
                walletTester = new WalletIntegrationTester();
                
                // Track progress through different test phases
                const testPhases = [
                    { name: 'Wallet Connection', percent: 15 },
                    { name: 'Balance Check', percent: 30 },
                    { name: 'Network Validation', percent: 45 },
                    { name: 'Gas Estimation', percent: 60 },
                    { name: 'Semantic Verification', percent: 80 },
                    { name: 'Batch Testing', percent: 95 },
                    { name: 'Complete', percent: 100 }
                ];
                
                let currentPhase = 0;
                const progressInterval = setInterval(() => {
                    if (currentPhase < testPhases.length) {
                        updateProgress(testPhases[currentPhase].percent);
                        updateStatus(`üîÑ ${testPhases[currentPhase].name}...`, 'info');
                        currentPhase++;
                    } else {
                        clearInterval(progressInterval);
                    }
                }, 2000);
                
                const results = await walletTester.runComprehensiveTests();
                clearInterval(progressInterval);
                
                displayComprehensiveResults(results);
                updateProgress(100);
                updateStatus('‚úÖ Comprehensive tests completed successfully!', 'success');
                
            } catch (error) {
                updateStatus('‚ùå Comprehensive tests failed: ' + error.message, 'error');
                console.error('Comprehensive test execution failed:', error);
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = 'üß™ Run All Wallet Tests';
                updateProgress(0);
            }
        };
        
        window.runQuickTest = async function() {
            const quickBtn = document.getElementById('run-quick-btn');
            quickBtn.disabled = true;
            quickBtn.innerHTML = '<div class="loading-indicator"></div>Quick Check...';
            
            try {
                updateStatus('‚ö° Running quick balance and network check...', 'info');
                
                walletTester = new WalletIntegrationTester();
                
                // Run just balance and network tests
                await walletTester.testWalletBalance();
                await walletTester.testNetworkCompatibility();
                
                displayQuickResults(walletTester.results);
                updateStatus('‚ö° Quick check completed', 'success');
                
            } catch (error) {
                updateStatus('‚ùå Quick test failed: ' + error.message, 'error');
                console.error('Quick test failed:', error);
            } finally {
                quickBtn.disabled = false;
                quickBtn.textContent = '‚ö° Quick Balance Check';
            }
        };
        
        window.openProductionDemo = function() {
            window.open('production_demo.html', '_blank');
        };
        
        window.clearResults = function() {
            testOutput = '';
            updateConsoleOutput();
            
            document.getElementById('wallet-info').innerHTML = 'Click "Run Wallet Tests" to check your wallet status';
            document.getElementById('network-info').innerHTML = '<div>Network validation not run yet...</div>';
            document.getElementById('balance-info').innerHTML = '<div>Balance check not run yet...</div>';
            document.getElementById('semantic-tests').innerHTML = '<div>Semantic verification tests not run yet...</div>';
            document.getElementById('test-summary').style.display = 'none';
            
            updateStatus('Ready to run comprehensive wallet integration tests', 'info');
            updateProgress(0);
        };
        
        function displayComprehensiveResults(results) {
            // Display wallet status
            displayWalletStatus(results);
            
            // Display network info
            displayNetworkInfo(results);
            
            // Display balance info
            displayBalanceInfo(results);
            
            // Display semantic tests
            displaySemanticTests(results);
            
            // Display summary
            displayTestSummary(results);
        }
        
        function displayQuickResults(results) {
            displayWalletStatus(results);
            displayNetworkInfo(results);
            displayBalanceInfo(results);
        }
        
        function displayWalletStatus(results) {
            const walletDiv = document.getElementById('wallet-info');
            
            if (results.wallet_tests && results.wallet_tests.length > 0) {
                const walletTest = results.wallet_tests[0];
                
                let html = `
                    <div class="metric">
                        <span class="metric-label">Connection Status</span>
                        <span class="metric-value">${walletTest.status}</span>
                    </div>
                `;
                
                if (walletTest.connected_wallet) {
                    html += `
                        <div class="metric">
                            <span class="metric-label">Connected Wallet</span>
                            <span class="metric-value ${walletTest.wallet_match ? '' : 'error'}">${walletTest.connected_wallet.slice(0, 8)}...${walletTest.connected_wallet.slice(-6)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Wallet Match</span>
                            <span class="metric-value ${walletTest.wallet_match ? '' : 'error'}">${walletTest.wallet_match ? '‚úÖ CORRECT' : '‚ùå WRONG WALLET'}</span>
                        </div>
                    `;
                }
                
                walletDiv.innerHTML = html;
            } else {
                walletDiv.innerHTML = '<div class="metric-value error">Wallet test not completed</div>';
            }
        }
        
        function displayNetworkInfo(results) {
            const networkDiv = document.getElementById('network-info');
            
            if (results.network_validation && Object.keys(results.network_validation).length > 0) {
                const network = results.network_validation;
                
                const html = `
                    <div class="metric">
                        <span class="metric-label">Chain ID</span>
                        <span class="metric-value ${network.chain_id_match ? '' : 'error'}">${network.current_chain_id}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Network Match</span>
                        <span class="metric-value ${network.chain_id_match ? '' : 'error'}">${network.chain_id_match ? '‚úÖ CORRECT' : '‚ùå WRONG NETWORK'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Latest Block</span>
                        <span class="metric-value">${network.latest_block?.toLocaleString() || 'N/A'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Network Status</span>
                        <span class="metric-value ${network.network_active ? '' : 'warning'}">${network.network_active ? 'üü¢ ACTIVE' : 'üü° INACTIVE'}</span>
                    </div>
                `;
                
                networkDiv.innerHTML = html;
            } else {
                networkDiv.innerHTML = '<div class="metric-value warning">Network validation not completed</div>';
            }
        }
        
        function displayBalanceInfo(results) {
            const balanceDiv = document.getElementById('balance-info');
            
            if (results.balance_info && results.balance_info.balance_a0gi !== undefined) {
                const balance = results.balance_info;
                
                let html = `
                    <div class="metric">
                        <span class="metric-label">Balance</span>
                        <span class="metric-value ${balance.has_tokens ? '' : 'warning'}">${balance.balance_a0gi} A0GI</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Has Tokens</span>
                        <span class="metric-value ${balance.has_tokens ? '' : 'warning'}">${balance.has_tokens ? '‚úÖ YES' : '‚ùå NO'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Test Ready</span>
                        <span class="metric-value ${balance.sufficient_for_tests ? '' : 'warning'}">${balance.sufficient_for_tests ? '‚úÖ YES' : '‚ö†Ô∏è NEED MORE'}</span>
                    </div>
                `;
                
                // Add gas cost info if available
                if (results.gas_info) {
                    const gas = results.gas_info;
                    html += `
                        <div class="metric">
                            <span class="metric-label">Gas Price</span>
                            <span class="metric-value">${gas.gas_price_gwei.toFixed(2)} Gwei</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">TX Cost Est.</span>
                            <span class="metric-value">${gas.total_estimated_cost.toFixed(8)} A0GI</span>
                        </div>
                    `;
                }
                
                balanceDiv.innerHTML = html;
            } else {
                balanceDiv.innerHTML = '<div class="metric-value warning">Balance check not completed</div>';
            }
        }
        
        function displaySemanticTests(results) {
            const semanticDiv = document.getElementById('semantic-tests');
            
            if (results.semantic_verification_tests && results.semantic_verification_tests.length > 0) {
                let html = '';
                
                results.semantic_verification_tests.forEach(test => {
                    const riskMatch = test.risk_level === test.expected_risk;
                    
                    html += `
                        <div class="verification-preview">
                            <strong>${test.test_name}</strong>
                            <div class="text-preview">"${test.text_preview}"</div>
                            <div class="metrics">
                                <span>‚Ñè‚Çõ: ${test.hbar_s.toFixed(4)}</span>
                                <span>P(fail): ${(test.p_fail * 100).toFixed(1)}%</span>
                                <span>Risk: ${test.risk_level}</span>
                                <span>${riskMatch ? '‚úÖ' : '‚ö†Ô∏è'} Expected: ${test.expected_risk}</span>
                            </div>
                        </div>
                    `;
                });
                
                // Add batch performance if available
                if (results.batch_performance) {
                    const batch = results.batch_performance;
                    html += `
                        <div class="metric" style="margin-top: 15px;">
                            <span class="metric-label">Batch Performance</span>
                            <span class="metric-value">${batch.throughput_per_second.toFixed(1)} verifications/sec</span>
                        </div>
                    `;
                }
                
                semanticDiv.innerHTML = html;
            } else {
                semanticDiv.innerHTML = '<div class="metric-value warning">Semantic verification tests not run yet</div>';
            }
        }
        
        function displayTestSummary(results) {
            const summaryDiv = document.getElementById('test-summary');
            const titleEl = document.getElementById('summary-title');
            const contentEl = document.getElementById('summary-content');
            
            const hasBalance = results.balance_info?.sufficient_for_tests;
            const correctNetwork = results.network_validation?.chain_id_match;
            const hasErrors = results.errors?.length > 0;
            const testsRun = results.semantic_verification_tests?.length > 0;
            const correctWallet = results.wallet_tests?.[0]?.wallet_match;
            
            // Determine overall status
            let overallStatus = 'error';
            let statusText = '‚ùå TESTS FAILED';
            let statusColor = '#ff4444';
            
            if (hasBalance && correctNetwork && !hasErrors && testsRun && correctWallet) {
                overallStatus = 'success';
                statusText = '‚úÖ PRODUCTION READY';
                statusColor = '#00ff41';
            } else if (correctNetwork && testsRun) {
                overallStatus = 'warning';
                statusText = '‚ö†Ô∏è PARTIALLY READY';
                statusColor = '#ffaa00';
            }
            
            // Set summary box style
            summaryDiv.className = `summary-box ${overallStatus}`;
            titleEl.textContent = statusText;
            titleEl.style.color = statusColor;
            
            // Create summary content
            let content = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">';
            
            content += `
                <div class="metric">
                    <span class="metric-label">Wallet Connection</span>
                    <span class="metric-value ${correctWallet ? '' : 'error'}">${correctWallet ? '‚úÖ CORRECT' : '‚ùå WRONG'}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Network</span>
                    <span class="metric-value ${correctNetwork ? '' : 'error'}">${correctNetwork ? '‚úÖ 0G NEWTON' : '‚ùå WRONG NET'}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">A0GI Balance</span>
                    <span class="metric-value ${hasBalance ? '' : 'warning'}">${hasBalance ? '‚úÖ SUFFICIENT' : '‚ö†Ô∏è LOW'}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Tests Completed</span>
                    <span class="metric-value ${testsRun ? '' : 'error'}">${testsRun ? '‚úÖ YES' : '‚ùå NO'}</span>
                </div>
            `;
            
            if (results.semantic_verification_tests?.length > 0) {
                const successfulTests = results.semantic_verification_tests.filter(t => 
                    t.risk_level === t.expected_risk
                ).length;
                const totalTests = results.semantic_verification_tests.length;
                
                content += `
                    <div class="metric">
                        <span class="metric-label">Test Accuracy</span>
                        <span class="metric-value">${successfulTests}/${totalTests} (${(successfulTests/totalTests*100).toFixed(0)}%)</span>
                    </div>
                `;
            }
            
            content += '</div>';
            
            // Add action items
            content += '<div style="margin-top: 20px; text-align: left;">';
            content += '<h4 style="color: #0099cc;">üéØ Next Steps:</h4>';
            content += '<ul style="color: #ccc; line-height: 1.8;">';
            
            if (overallStatus === 'success') {
                content += '<li>‚úÖ Ready for production blockchain verification</li>';
                content += '<li>üöÄ Visit production demo and start testing</li>';
                content += '<li>‚õìÔ∏è Submit real transactions to 0G testnet</li>';
            } else {
                if (!correctWallet) {
                    content += '<li>ü¶ä Switch MetaMask to the correct wallet address</li>';
                }
                if (!correctNetwork) {
                    content += '<li>üåê Switch MetaMask to 0G Newton testnet (Chain ID: 16600)</li>';
                }
                if (!hasBalance) {
                    content += '<li>üí∞ Get more A0GI tokens from the faucet</li>';
                }
                if (!testsRun) {
                    content += '<li>üß™ Re-run tests after fixing issues</li>';
                }
            }
            
            content += '</ul></div>';
            contentEl.innerHTML = content;
            summaryDiv.style.display = 'block';
        }
        
        // Initialize page
        setTimeout(() => {
            console.log('üß™ Wallet Integration Test Runner Initialized');
            console.log('üí≥ Target Wallet: 0x9B613eD794B81043C23fA4a19d8f674090313b81');
            console.log('‚õìÔ∏è Target Network: 0G Newton Testnet (Chain ID: 16600)');
            console.log('üöÄ Click "Run All Wallet Tests" to begin comprehensive testing');
        }, 1000);
    </script>
</body>
</html>