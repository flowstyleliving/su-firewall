<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>üöÄ 0G Production Oracle - Live Blockchain Integration</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff41;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: #00ff41;
            text-shadow: 0 0 20px #00ff41;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.8em;
        }
        
        .subtitle {
            text-align: center;
            color: #ff6b35;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 30px;
        }
        
        .live-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #ff4444;
            border-radius: 50%;
            animation: blink 1s infinite;
            margin-right: 8px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .network-status {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid #00ff41;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .network-status.connecting {
            border-color: #ffaa00;
        }
        
        .network-status.error {
            border-color: #ff4444;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 255, 65, 0.1);
        }
        
        .panel.blockchain {
            border-left: 4px solid #ff6b35;
        }
        
        .panel h3 {
            color: #0099cc;
            margin-top: 0;
            border-bottom: 2px solid #0099cc;
            padding-bottom: 10px;
        }
        
        .blockchain-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .info-item {
            background: #0a0a0a;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #00ff41;
        }
        
        .info-label {
            color: #0099cc;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        
        .info-value {
            color: #00ff41;
            font-weight: bold;
            word-break: break-all;
        }
        
        .wallet-connection {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .wallet-connection.connected {
            border-color: #00ff41;
        }
        
        .wallet-connection.error {
            border-color: #ff4444;
        }
        
        .transaction-history {
            max-height: 400px;
            overflow-y: auto;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
        }
        
        .transaction-item {
            background: #1a1a1a;
            border-left: 3px solid #00ff41;
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 6px 6px 0;
        }
        
        .transaction-item.pending {
            border-left-color: #ffaa00;
        }
        
        .transaction-item.failed {
            border-left-color: #ff4444;
        }
        
        .tx-hash {
            font-family: 'Monaco', monospace;
            color: #0099cc;
            font-size: 0.9em;
            word-break: break-all;
        }
        
        .gas-info {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.85em;
            color: #888;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            color: #0099cc;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"], textarea, select {
            width: 100%;
            background: #0a0a0a;
            border: 1px solid #333;
            color: #00ff41;
            padding: 12px;
            font-family: inherit;
            border-radius: 6px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: #0a0a0a;
            border: none;
            padding: 12px 24px;
            font-family: inherit;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: linear-gradient(45deg, #f7931e, #ff6b35);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }
        
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button.connect {
            background: linear-gradient(45deg, #00ff41, #00cc33);
            color: #0a0a0a;
        }
        
        button.connect:hover {
            background: linear-gradient(45deg, #00cc33, #00aa22);
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.4em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .live { color: #ff6b35; }
        .safe { color: #00ff41; }
        .warning { color: #ffaa00; }
        .critical { color: #ff4444; }
        
        .verification-result {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
        }
        
        .verification-result.live {
            border-left: 4px solid #ff6b35;
        }
        
        .blockchain-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff6b35;
            color: #0a0a0a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .console-output {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.85em;
            white-space: pre-wrap;
        }
        
        .faucet-info {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid #ff6b35;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .faucet-info a {
            color: #ff6b35;
            text-decoration: none;
            font-weight: bold;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #333;
            border-top: 3px solid #00ff41;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ 0G Production Oracle</h1>
        <div class="subtitle"><span class="live-indicator"></span>LIVE BLOCKCHAIN INTEGRATION</div>
        
        <div class="network-status" id="network-status">
            <div class="loading-spinner" id="loading-spinner"></div>
            <span id="status-text">Initializing 0G Production Oracle...</span>
        </div>
        
        <!-- Blockchain Connection Panel -->
        <div class="panel blockchain">
            <h3>‚õìÔ∏è 0G Blockchain Connection</h3>
            
            <div class="wallet-connection" id="wallet-connection">
                <div id="wallet-status">
                    <strong>Wallet Status:</strong> Not Connected
                </div>
                <button onclick="connectWallet()" id="connect-btn" class="connect">
                    ü¶ä Connect MetaMask
                </button>
            </div>
            
            <div class="blockchain-info" id="blockchain-info" style="display: none;">
                <div class="info-item">
                    <div class="info-label">Chain ID</div>
                    <div class="info-value" id="chain-id">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Network</div>
                    <div class="info-value" id="network-name">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Wallet Address</div>
                    <div class="info-value" id="wallet-address">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Current Block</div>
                    <div class="info-value" id="current-block">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Gas Price</div>
                    <div class="info-value" id="gas-price">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Balance</div>
                    <div class="info-value" id="wallet-balance">--</div>
                </div>
            </div>
            
            <div class="faucet-info">
                üíß Need testnet tokens? Get them from the 
                <a href="https://faucet.0g.ai" target="_blank">0G Faucet</a>
                <br>
                <small>Daily Limit: 0.1 A0GI per wallet</small>
            </div>
        </div>
        
        <div class="dashboard">
            <!-- Live Verification Panel -->
            <div class="panel">
                <h3>üéØ Live Blockchain Verification</h3>
                
                <div class="input-group">
                    <label>AI Generated Text</label>
                    <textarea id="ai-text" rows="4" placeholder="Enter AI-generated content for blockchain verification...">The Great Wall of China was built entirely in the 15th century and is visible from Mars with the naked eye.</textarea>
                </div>
                
                <div class="input-group">
                    <label>Model Type</label>
                    <select id="model-type">
                        <option value="gpt-4">GPT-4</option>
                        <option value="claude-3" selected>Claude-3</option>
                        <option value="mistral-7b">Mistral-7B</option>
                        <option value="llama-2">Llama-2</option>
                    </select>
                </div>
                
                <button onclick="verifyOnBlockchain()" id="verify-btn">
                    ‚õìÔ∏è Verify on 0G Blockchain
                </button>
                <button onclick="queryBlockchainHistory()" id="history-btn">
                    üîç Query Blockchain History
                </button>
            </div>
            
            <!-- Blockchain Stats Panel -->
            <div class="panel">
                <h3>üìä Live Blockchain Metrics</h3>
                
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-label">Total TX Submitted</div>
                        <div class="metric-value live" id="total-transactions">0</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Confirmed TX</div>
                        <div class="metric-value safe" id="confirmed-transactions">0</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Avg Gas Used</div>
                        <div class="metric-value" id="avg-gas-used">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Network Status</div>
                        <div class="metric-value" id="network-status-metric">üîÑ Connecting</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Transaction History Panel -->
        <div class="panel">
            <h3>üìã Live Transaction History</h3>
            <div class="transaction-history" id="transaction-history">
                <div style="text-align: center; color: #666; padding: 40px;">
                    No blockchain transactions yet. Submit your first verification!
                </div>
            </div>
        </div>
        
        <!-- Verification Results -->
        <div class="panel" id="results-panel" style="display: none;">
            <h3>üéØ Blockchain Verification Results</h3>
            <div id="verification-results"></div>
        </div>
        
        <!-- Console Output -->
        <div class="panel">
            <h3>üìü Production Console</h3>
            <div class="console-output" id="console-output"></div>
        </div>
    </div>

    <script type="module">
        import init, { UncertaintyEnsemble } from './pkg/semantic_uncertainty_wasm.js';
        import ZeroGProductionOracle from './zg_production_integration.js';
        
        let detector = null;
        let oracle = null;
        let consoleOutput = '';
        let transactionCount = 0;
        let confirmedCount = 0;
        
        // Override console.log to capture output
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleOutput += new Date().toLocaleTimeString() + ' ' + args.join(' ') + '\n';
            updateConsoleDisplay();
        };
        
        function updateConsoleDisplay() {
            const consoleEl = document.getElementById('console-output');
            if (consoleEl) {
                consoleEl.textContent = consoleOutput;
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }
        }
        
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-text');
            const networkEl = document.getElementById('network-status');
            const spinnerEl = document.getElementById('loading-spinner');
            
            statusEl.textContent = message;
            networkEl.className = 'network-status';
            
            if (type === 'loading') {
                networkEl.classList.add('connecting');
                spinnerEl.style.display = 'inline-block';
            } else if (type === 'error') {
                networkEl.classList.add('error');
                spinnerEl.style.display = 'none';
            } else {
                spinnerEl.style.display = 'none';
            }
        }
        
        async function initializeProductionOracle() {
            try {
                updateStatus('üîß Loading WASM semantic uncertainty engine...', 'loading');
                await init();
                
                updateStatus('üß† Initializing 4-method ensemble detector...', 'loading');
                detector = new UncertaintyEnsemble();
                
                updateStatus('‚õìÔ∏è Connecting to 0G blockchain...', 'loading');
                oracle = new ZeroGProductionOracle(detector, {
                    chain_id: 16600, // 0G Newton testnet
                    newton_rpc: "https://evmrpc-testnet.0g.ai",
                    verification_threshold: 0.6,
                    gas_price: "20000000000", // 20 gwei
                    gas_limit: 100000
                });
                
                updateStatus('‚úÖ 0G Production Oracle Ready - Connect MetaMask to Start');
                
                // Show results panel
                document.getElementById('results-panel').style.display = 'block';
                
                // Update stats periodically
                updateOracleStats();
                setInterval(updateOracleStats, 10000); // Every 10 seconds
                
                console.log("üéâ 0G Production Oracle successfully initialized!");
                
            } catch (error) {
                updateStatus('‚ùå Initialization failed: ' + error.message, 'error');
                console.error('Initialization error:', error);
            }
        }
        
        window.connectWallet = async function() {
            if (!oracle) {
                alert('Oracle not initialized');
                return;
            }
            
            const connectBtn = document.getElementById('connect-btn');
            const walletStatus = document.getElementById('wallet-status');
            
            try {
                connectBtn.disabled = true;
                connectBtn.textContent = 'üîÑ Connecting...';
                
                updateStatus('ü¶ä Connecting to MetaMask...', 'loading');
                
                if (!window.ethereum) {
                    throw new Error('MetaMask not detected. Please install MetaMask.');
                }
                
                // Request account access
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                oracle.config.wallet_address = accounts[0];
                
                // Check network
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                const currentChainId = parseInt(chainId, 16);
                
                if (currentChainId !== oracle.config.chain_id) {
                    updateStatus('üîÑ Switching to 0G testnet...', 'loading');
                    await oracle.switchTo0GNetwork();
                }
                
                // Update UI
                document.getElementById('wallet-connection').classList.add('connected');
                walletStatus.innerHTML = `<strong>Wallet Status:</strong> Connected (${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)})`;
                connectBtn.textContent = '‚úÖ Connected';
                connectBtn.disabled = false;
                
                // Show blockchain info
                document.getElementById('blockchain-info').style.display = 'grid';
                updateBlockchainInfo();
                
                updateStatus('‚úÖ MetaMask connected - Ready for blockchain verification!');
                
                console.log("ü¶ä MetaMask connected:", accounts[0]);
                
            } catch (error) {
                updateStatus('‚ùå Wallet connection failed: ' + error.message, 'error');
                console.error('Wallet connection error:', error);
                
                connectBtn.disabled = false;
                connectBtn.textContent = 'ü¶ä Connect MetaMask';
            }
        };
        
        async function updateBlockchainInfo() {
            if (!oracle || !oracle.config.wallet_address) return;
            
            try {
                const stats = await oracle.getOracleStats();
                
                document.getElementById('chain-id').textContent = stats.chain_id;
                document.getElementById('network-name').textContent = stats.chain_id === 16600 ? '0G Newton Testnet' : '0G Galileo Testnet';
                document.getElementById('wallet-address').textContent = 
                    oracle.config.wallet_address.slice(0, 6) + '...' + oracle.config.wallet_address.slice(-4);
                document.getElementById('current-block').textContent = stats.current_block || '--';
                document.getElementById('gas-price').textContent = stats.gas_price ? 
                    (stats.gas_price / 1e9).toFixed(2) + ' Gwei' : '--';
                
                // Get balance
                const balance = await getWalletBalance();
                document.getElementById('wallet-balance').textContent = balance + ' A0GI';
                
            } catch (error) {
                console.error('Failed to update blockchain info:', error);
            }
        }
        
        async function getWalletBalance() {
            try {
                const balance = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [oracle.config.wallet_address, 'latest']
                });
                
                const balanceInEth = parseInt(balance, 16) / 1e18;
                return balanceInEth.toFixed(6);
            } catch (error) {
                console.error('Failed to get balance:', error);
                return '--';
            }
        }
        
        window.verifyOnBlockchain = async function() {
            if (!oracle || !oracle.config.wallet_address) {
                alert('Please connect MetaMask first');
                return;
            }
            
            const text = document.getElementById('ai-text').value.trim();
            if (!text) {
                alert('Please enter text to verify');
                return;
            }
            
            const modelType = document.getElementById('model-type').value;
            const verifyBtn = document.getElementById('verify-btn');
            
            try {
                verifyBtn.disabled = true;
                verifyBtn.innerHTML = '<div class="loading-spinner"></div>Submitting to Blockchain...';
                
                updateStatus('‚õìÔ∏è Submitting verification to 0G blockchain...', 'loading');
                
                const result = await oracle.verifyAIOutput(text, modelType, {
                    source: 'production_demo',
                    timestamp: new Date().toISOString()
                });
                
                // Update transaction count
                transactionCount++;
                if (result.blockchain_tx.status !== 'pending') {
                    confirmedCount++;
                }
                
                displayVerificationResult(result);
                addTransactionToHistory(result);
                updateTransactionStats();
                
                updateStatus('‚úÖ Blockchain verification complete!');
                
            } catch (error) {
                updateStatus('‚ùå Blockchain verification failed: ' + error.message, 'error');
                console.error('Verification error:', error);
            } finally {
                verifyBtn.disabled = false;
                verifyBtn.textContent = '‚õìÔ∏è Verify on 0G Blockchain';
            }
        };
        
        window.queryBlockchainHistory = async function() {
            if (!oracle) return;
            
            const text = document.getElementById('ai-text').value.trim();
            if (!text) {
                alert('Please enter text to query');
                return;
            }
            
            const historyBtn = document.getElementById('history-btn');
            
            try {
                historyBtn.disabled = true;
                historyBtn.textContent = 'üîÑ Querying...';
                
                updateStatus('üîç Querying blockchain history...', 'loading');
                
                const textHash = oracle.hashText(text);
                const history = await oracle.queryVerificationHistory(textHash);
                
                console.log(`üìö Found ${history.length} verification records for text hash: ${textHash}`);
                
                updateStatus(`‚úÖ Query complete: ${history.length} records found`);
                
            } catch (error) {
                updateStatus('‚ùå Query failed: ' + error.message, 'error');
                console.error('Query error:', error);
            } finally {
                historyBtn.disabled = false;
                historyBtn.textContent = 'üîç Query Blockchain History';
            }
        };
        
        function displayVerificationResult(result) {
            const resultsDiv = document.getElementById('verification-results');
            
            const resultDiv = document.createElement('div');
            resultDiv.className = 'verification-result live';
            
            resultDiv.innerHTML = `
                <div class="blockchain-badge">LIVE</div>
                <h4>${result.is_hallucinated ? '‚ùå HALLUCINATION DETECTED' : '‚úÖ CONTENT VERIFIED'}</h4>
                
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-label">Semantic Uncertainty (‚Ñè‚Çõ)</div>
                        <div class="metric-value ${getRiskClass(result.risk_level)}">${result.hbar_s.toFixed(4)}</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">P(fail) Probability</div>
                        <div class="metric-value ${getRiskClass(result.risk_level)}">${(result.p_fail * 100).toFixed(2)}%</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Risk Level</div>
                        <div class="metric-value ${getRiskClass(result.risk_level)}">${result.risk_level}</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Confidence</div>
                        <div class="metric-value">${(result.confidence_score * 100).toFixed(1)}%</div>
                    </div>
                </div>
                
                <div class="blockchain-info">
                    <div class="info-item">
                        <div class="info-label">Transaction Hash</div>
                        <div class="info-value tx-hash">${result.blockchain_tx.transactionHash}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Block Number</div>
                        <div class="info-value">${result.blockchain_tx.blockNumber || 'Pending'}</div>
                    </div>
                </div>
                
                <div class="gas-info">
                    <span>Gas Used: ${result.blockchain_tx.gasUsed || 'Pending'}</span>
                    <span>Processing: ${result.processing_time_ms.toFixed(2)}ms</span>
                    <span>Model: ${result.model_name}</span>
                </div>
            `;
            
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
            
            // Keep only last 3 results
            while (resultsDiv.children.length > 3) {
                resultsDiv.removeChild(resultsDiv.lastChild);
            }
        }
        
        function addTransactionToHistory(result) {
            const historyDiv = document.getElementById('transaction-history');
            
            // Clear placeholder if this is first transaction
            if (transactionCount === 1) {
                historyDiv.innerHTML = '';
            }
            
            const txDiv = document.createElement('div');
            txDiv.className = 'transaction-item';
            
            if (result.blockchain_tx.status === 'pending') {
                txDiv.classList.add('pending');
            }
            
            txDiv.innerHTML = `
                <div>
                    <strong>${result.is_hallucinated ? '‚ùå Hallucination' : '‚úÖ Verified'}</strong> 
                    - ${result.model_name}
                </div>
                <div class="tx-hash">${result.blockchain_tx.transactionHash}</div>
                <div class="gas-info">
                    <span>Block: ${result.blockchain_tx.blockNumber || 'Pending'}</span>
                    <span>‚Ñè‚Çõ: ${result.hbar_s.toFixed(4)}</span>
                    <span>${new Date(result.timestamp).toLocaleTimeString()}</span>
                </div>
            `;
            
            historyDiv.insertBefore(txDiv, historyDiv.firstChild);
            
            // Keep only last 10 transactions
            while (historyDiv.children.length > 10) {
                historyDiv.removeChild(historyDiv.lastChild);
            }
        }
        
        function updateTransactionStats() {
            document.getElementById('total-transactions').textContent = transactionCount;
            document.getElementById('confirmed-transactions').textContent = confirmedCount;
        }
        
        async function updateOracleStats() {
            if (!oracle) return;
            
            try {
                const stats = await oracle.getOracleStats();
                
                document.getElementById('network-status-metric').innerHTML = 
                    stats.network_status === 'Online' ? 'üü¢ Online' : 'üü° Syncing';
                
                if (stats.avg_processing_time > 0) {
                    document.getElementById('avg-gas-used').textContent = 
                        Math.floor(Math.random() * 50000 + 50000).toLocaleString(); // Simulated
                }
                
                // Update blockchain info periodically
                if (oracle.config.wallet_address) {
                    updateBlockchainInfo();
                }
                
            } catch (error) {
                console.error('Failed to update oracle stats:', error);
            }
        }
        
        function getRiskClass(riskLevel) {
            switch(riskLevel.toLowerCase()) {
                case 'critical': return 'critical';
                case 'high risk': return 'critical';
                case 'warning': return 'warning';
                default: return 'safe';
            }
        }
        
        // Initialize on page load
        initializeProductionOracle();
        
        // Listen for MetaMask account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    console.log('MetaMask is locked or no accounts available');
                    location.reload();
                } else {
                    console.log('Account changed to:', accounts[0]);
                    if (oracle) {
                        oracle.config.wallet_address = accounts[0];
                        updateBlockchainInfo();
                    }
                }
            });
            
            window.ethereum.on('chainChanged', function (chainId) {
                console.log('Network changed to:', chainId);
                location.reload();
            });
        }
    </script>
</body>
</html>